<!DOCTYPE html>
<html>

<head>
<title>Waterscope</title>  
<script src="static/jquery_3.2.1.min.js"></script>
  <script>
  "use strict";

function openSetting(evt, SettingName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
        tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
        tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(SettingName).style.display = "block";
    evt.currentTarget.className += " active";
}

//Update the value of camera settings
function updateTextInput(val) {
          document.getElementById('textInput').value=val; 
        }

  const STREAM_CTL_URL = 'http://172.24.1.1:5000/start_stream';
  const MOTOR_CTL_URL = 'http://172.24.1.1:5000/move';
  const CAPTURE_URL = 'http://172.24.1.1:5000/capture';
  const STREAM_URL = 'http://172.24.1.1:8080/?action=stream';

  function start_stream(width=1280, height=720, fps=10, sharpness=0, contrast=0, brightness=50, saturation=0){
    $.ajax({
      url: STREAM_CTL_URL,
      data: {
        width: width,
        height: height,
        fps: fps,
        sharpness: sharpness,
        contrast: contrast,
        brightness: brightness,
        saturation: saturation,
      },
      success: function(){
        load_stream();
      },
      error: function(){
        alert('Could not restart stream with new parameters');
      }
    });
  }

  function load_stream(width=1280, height=720, fps=10){
    $('#stream_container').empty()
      .append(`<img id="stream" width="${width}" height="${height}" src="${STREAM_URL}" />`);
  }

  function capture_url(sharpness=0, contrast=0, brightness=50, saturation=0){
    // Returns the URL that you need to go to to capture and download an image.
    return `${CAPTURE_URL}?sharpness=${sharpness}&contrast=${contrast}&brightness=${brightness}&saturation=${saturation}`;
  }

  function create_capture_link(){
    $('#capture_link_container').empty()
      .append(`<a href="${capture_url()}" download>Capture and Download Image</a>`);
  }

  function move(x=0, y=0 , z=0){
    $.ajax({
      url: WS_MOTOR_CTL_URL,
      data: {
        x: x,
        y: y,
        z: z,
      },
      error: function(){
        alert('Error when attempting to move motors');
      }
    });
  }

  
  // Execute this when document has loaded
  $(function(){
    load_stream();
    create_capture_link();
  });
  </script>
  <title>WaterScope</title>
</head>

<body>
  <body>
  <p class="title">WaterScope</p>
  <div id="stream_container"></div>
  <div class="button" id="capture_link_container"> <button class="click">Capture Photo</button></div>
  
  <br/>
  
  <h2 class="header">Motor Control</h2>
  <div class="button"><button class="plane_control">&#x25B2</button>
  <div class="button">
    <button class="plane_control">&#x25C0</button>
    <button class="plane_control">&#x25BC</button>
    <button class="plane_control">&#x25BA</button>
  </div>
  
  <br/>
  
  <h2 class="header">Camera Settings</h2>
  <div class="tab">
    <button class="tablinks" onclick="openSetting(event, 'Sharpness')">Sharpness</button>
    <button class="tablinks" onclick="openSetting(event, 'Brightness')">Brightness</button>
    <button class="tablinks" onclick="openSetting(event, 'Contrast')">Contrast</button>
    <button class="tablinks" onclick="openSetting(event, 'Saturation')">Saturation</button>
  </div>

<div id="Sharpness" class="tabcontent">
  <p>Change the sharpness of the video stream</p>
  <input id="contrast" type="range" min="100" max="500" step="10" />
  <input type="text" id="textInput" value="">
</div>

<div id="Brightness" class="tabcontent">
  <p>Change the brightness of the video stream</p>
  <input id="contrast" type="range" min="100" max="500" step="10" />
  <input type="text" id="textInput" value="">
</div>

<div id="Contrast" class="tabcontent">
  <p>Change the contrast of the video stream</p>
  <input id="contrast" type="range" min="100" max="500" step="10" />
  <input type="text" id="textInput" value="">
</div>
  
  <div id="Saturation" class="tabcontent">
    <p>Change the saturation of the video stream</p>
  <input id="contrast" type="range" min="100" max="500" step="10" />
  <input type="text" id="textInput" value="">
</div>
  <div >
  </div>
</body>

</html>
